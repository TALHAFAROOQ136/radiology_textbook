(globalThis.webpackChunkradiology_textbook_frontend=globalThis.webpackChunkradiology_textbook_frontend||[]).push([[176,795],{442(e,o,t){"use strict";t.d(o,{A:()=>T});var i=t(6540),n=t(7164),l=t(8836),r=t(8290),d=t(1474),s=t(1677),a=t.n(s),c=t(5915),p=t.n(c),x=t(4848);a().external.cornerstone=n,a().external.dicomParser=p();const{Du:u,CH:g,OQ:f,LW:b,N7:m,RectangleRoiTool:h,EllipticalRoiTool:y,yT:v,Mu:j,dU:C}=r,T=({dicomUrl:e,width:o="100%",height:t="600px",onLoadingStart:r,onLoadingComplete:s,onError:a})=>{const c=(0,i.useRef)(null),[p,T]=(0,i.useState)(!0),[w,A]=(0,i.useState)(null);return(0,i.useEffect)(()=>{let o=null,t=null;return(async()=>{if(c.current){o=c.current;try{l.Ay(o)||n.enable(o),d.Ts(),t="dicom-tool-group";const i=C.createToolGroup(t);i.addTool(u.toolName),i.addTool(g.toolName),i.addTool(f.toolName),i.addTool(b.toolName),i.addTool(m.toolName),i.addTool(h.toolName),i.addTool(y.toolName),i.addTool(v.toolName),i.addTool(j.toolName),i.setToolActive(u.toolName,{bindings:[{mouseButton:0}],cursor:"grab"}),i.setToolActive(g.toolName,{bindings:[{mouseButton:2}],cursor:"move"}),i.setToolActive(f.toolName,{bindings:[{mouseButton:1}],cursor:"zoom-in"}),i.setToolActive(b.toolName,{bindings:[{mouseButton:0}],cursor:"crosshair"}),i.setToolActive(m.toolName,{bindings:[{mouseButton:0}],cursor:"crosshair"}),i.setToolActive(h.toolName,{bindings:[{mouseButton:0}],cursor:"crosshair"}),i.setToolActive(y.toolName,{bindings:[{mouseButton:0}],cursor:"crosshair"}),i.setToolActive(v.toolName,{bindings:[{mouseButton:0}],cursor:"crosshair"}),i.setToolActive(j.toolName,{bindings:[{mouseButton:0}],cursor:"crosshair"}),i.addEnabledElement(l.Ay(o)),r&&r();const a=`wadouri:${e}`,c=await n.loadImage(a);n.displayImage(o,c),T(!1),s&&s()}catch(i){console.error("Error initializing DICOM viewer:",i),A(i instanceof Error?i.message:"Failed to load DICOM image"),T(!1),a&&a(i)}}})(),()=>{if(o)try{n.disable(o)}catch(e){console.warn("Error disabling cornerstone:",e)}if(t)try{C.destroyToolGroup(t)}catch(e){console.warn("Error destroying tool group:",e)}}},[e,r,s,a]),(0,x.jsxs)("div",{style:{position:"relative",width:o,height:t},children:[p&&(0,x.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f0f0f0",zIndex:10},children:"Loading DICOM image..."}),w&&(0,x.jsxs)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#ffebee",color:"#c62828",zIndex:10},children:["Error loading DICOM: ",w]}),(0,x.jsx)("div",{ref:c,style:{width:"100%",height:"100%",border:"1px solid #ccc",backgroundColor:"#000"}})]})}},1234(){},6559(){},9432(e,o,t){"use strict";t.r(o),t.d(o,{default:()=>a});var i=t(6540),n=t(442),l=t(3239),r=t(4848);const d=({element:e,onToolChange:o})=>{const[t,n]=(0,i.useState)("WindowLevel"),d=[{name:"WindowLevel",icon:"_contrast",label:"Window Level"},{name:"Pan",icon:"pan_tool",label:"Pan"},{name:"Zoom",icon:"zoom_in",label:"Zoom"},{name:"Length",icon:"straighten",label:"Measure"},{name:"Probe",icon:"location_on",label:"Pixel Value"},{name:"RectangleRoi",icon:"crop_square",label:"Rectangle ROI"},{name:"EllipticalRoi",icon:"circle",label:"Ellipse ROI"},{name:"Angle",icon:"gesture",label:"Angle"},{name:"Bidirectional",icon:"linear_scale",label:"Bidirectional"}];return(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px",padding:"10px",backgroundColor:"#f5f5f5",borderRadius:"4px",border:"1px solid #ddd",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,r.jsx)("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"8px",textAlign:"center"},children:"Tools"}),(0,r.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"4px"},children:d.map(e=>(0,r.jsxs)("button",{onClick:()=>(e=>{n(e);const t=l.getActiveToolGroup();t&&(d.forEach(e=>{t.setToolPassive(e.name)}),t.setToolActive(e,{bindings:[{mouseButton:0}]})),o&&o(e)})(e.name),style:{padding:"8px",margin:"2px",border:t===e.name?"2px solid #007bff":"1px solid #ccc",backgroundColor:t===e.name?"#e6f0ff":"#fff",borderRadius:"4px",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",fontSize:"12px"},title:e.label,children:[(0,r.jsx)("span",{style:{fontSize:"16px",marginBottom:"2px"},children:e.icon}),(0,r.jsx)("span",{children:e.label})]},e.name))}),(0,r.jsxs)("div",{style:{borderTop:"1px solid #ddd",paddingTop:"8px",marginTop:"8px"},children:[(0,r.jsx)("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"8px",textAlign:"center"},children:"View Controls"}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[(0,r.jsx)("button",{onClick:()=>{o&&o("reset")},style:{padding:"8px",border:"1px solid #ccc",backgroundColor:"#fff",borderRadius:"4px",cursor:"pointer"},children:"Reset View"}),(0,r.jsx)("button",{onClick:()=>{o&&o("fit-to-window")},style:{padding:"8px",border:"1px solid #ccc",backgroundColor:"#fff",borderRadius:"4px",cursor:"pointer"},children:"Fit to Window"})]})]})]})},s=({element:e,onAnnotationsChange:o})=>{const[t,n]=(0,i.useState)([]),[l,d]=(0,i.useState)(null),[s,a]=(0,i.useState)(!0),[c,p]=(0,i.useState)(""),[x,u]=(0,i.useState)("");(0,i.useEffect)(()=>{const e=[{id:"1",toolType:"Length",data:{length:25.5,unit:"mm"},label:"Lesion diameter",description:"Measurement of lesion size",color:"#FF0000",visible:!0,createdAt:new Date},{id:"2",toolType:"RectangleRoi",data:{area:120.5,unit:"mm\xb2"},label:"ROI Area",description:"Region of interest",color:"#00FF00",visible:!0,createdAt:new Date(Date.now()-36e5)}];n(e)},[]);return(0,r.jsxs)("div",{style:{padding:"15px",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #dee2e6"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[(0,r.jsx)("h3",{style:{margin:0,fontSize:"16px",color:"#495057"},children:"Annotations & Measurements"}),(0,r.jsx)("div",{style:{display:"flex",gap:"8px"},children:(0,r.jsxs)("button",{onClick:()=>a(!s),style:{padding:"4px 8px",border:"1px solid #ced4da",borderRadius:"4px",backgroundColor:s?"#e7f1ff":"#fff",cursor:"pointer",fontSize:"12px"},children:[s?"Hide":"Show"," All"]})})]}),(0,r.jsxs)("div",{style:{marginBottom:"15px",padding:"10px",backgroundColor:"#fff",borderRadius:"4px",border:"1px solid #e9ecef"},children:[(0,r.jsx)("div",{style:{marginBottom:"8px",fontSize:"14px",fontWeight:"bold"},children:"Add New Annotation"}),(0,r.jsx)("input",{type:"text",value:c,onChange:e=>p(e.target.value),placeholder:"Annotation label",style:{width:"100%",padding:"6px 10px",marginBottom:"8px",border:"1px solid #ced4da",borderRadius:"4px",fontSize:"14px"}}),(0,r.jsx)("textarea",{value:x,onChange:e=>u(e.target.value),placeholder:"Description (optional)",rows:2,style:{width:"100%",padding:"6px 10px",marginBottom:"8px",border:"1px solid #ced4da",borderRadius:"4px",fontSize:"14px",resize:"vertical"}}),(0,r.jsx)("button",{onClick:()=>{if(!c.trim())return;const e={id:`ann_${Date.now()}`,toolType:"Text",data:{},label:c,description:x,color:"#FFFF00",visible:!0,createdAt:new Date},i=[...t,e];n(i),p(""),u(""),o&&o(i)},disabled:!c.trim(),style:{padding:"6px 12px",backgroundColor:"#007bff",color:"#fff",border:"none",borderRadius:"4px",cursor:c.trim()?"pointer":"not-allowed",fontSize:"14px"},children:"Add Annotation"})]}),(0,r.jsx)("div",{style:{maxHeight:"300px",overflowY:"auto"},children:0===t.length?(0,r.jsx)("div",{style:{textAlign:"center",padding:"20px",color:"#6c757d"},children:"No annotations yet. Use the tools to measure or annotate."}):(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:t.map(e=>{return(0,r.jsx)("div",{onClick:()=>{return o=e.id,void d(l===o?null:o);var o},style:{padding:"10px",backgroundColor:l===e.id?"#e7f1ff":"#fff",border:"1px solid "+(l===e.id?"#007bff":"#dee2e6"),borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s"},children:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"4px"},children:[(0,r.jsx)("span",{style:{display:"inline-block",width:"12px",height:"12px",borderRadius:"50%",backgroundColor:e.color||"#007bff",border:"1px solid #ccc"}}),(0,r.jsx)("span",{style:{fontWeight:"bold",fontSize:"14px"},children:e.label||`${e.toolType} Measurement`}),(0,r.jsx)("span",{style:{padding:"2px 6px",backgroundColor:"#e9ecef",borderRadius:"12px",fontSize:"10px",textTransform:"uppercase"},children:e.toolType})]}),e.description&&(0,r.jsx)("div",{style:{fontSize:"13px",color:"#495057",marginBottom:"4px"},children:e.description}),e.data.length&&(0,r.jsxs)("div",{style:{fontSize:"12px",color:"#6c757d"},children:["Length: ",e.data.length," ",e.data.unit]}),e.data.area&&(0,r.jsxs)("div",{style:{fontSize:"12px",color:"#6c757d"},children:["Area: ",e.data.area," ",e.data.unit]}),(0,r.jsx)("div",{style:{fontSize:"11px",color:"#adb5bd",marginTop:"4px"},children:(i=e.createdAt,new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(i))})]}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[(0,r.jsx)("button",{onClick:i=>{i.stopPropagation(),(e=>{const i=t.map(o=>o.id===e?{...o,visible:!o.visible}:o);n(i),o&&o(i)})(e.id)},style:{padding:"4px",border:"1px solid #ced4da",borderRadius:"4px",backgroundColor:e.visible?"#d4edda":"#f8d7da",color:e.visible?"#155724":"#721c24",cursor:"pointer",fontSize:"12px"},children:e.visible?"Visible":"Hidden"}),(0,r.jsx)("button",{onClick:i=>{i.stopPropagation(),(e=>{const i=t.filter(o=>o.id!==e);n(i),l===e&&d(null),o&&o(i)})(e.id)},style:{padding:"4px",border:"1px solid #dc3545",borderRadius:"4px",backgroundColor:"#fff",color:"#dc3545",cursor:"pointer",fontSize:"12px"},children:"Delete"})]})]})},e.id);var i})})})]})},a=({dicomUrl:e,showAnnotations:o=!0,showToolbar:t=!0,width:l="100%",height:a="700px"})=>{const[c,p]=(0,i.useState)("WindowLevel");return(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:o?"1fr 300px":"1fr",gap:"15px",width:l,height:a},children:[(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",border:"1px solid #ddd",borderRadius:"4px",overflow:"hidden"},children:[t&&(0,r.jsxs)("div",{style:{padding:"10px",backgroundColor:"#f8f9fa",borderBottom:"1px solid #dee2e6",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)("div",{style:{fontSize:"16px",fontWeight:"bold",color:"#495057"},children:"DICOM Viewer"}),(0,r.jsxs)("div",{style:{fontSize:"12px",color:"#6c757d"},children:["Current Tool: ",c]})]}),(0,r.jsx)("div",{style:{flex:1,padding:t?"10px":"0"},children:(0,r.jsx)(n.A,{dicomUrl:e,onLoadingComplete:()=>console.log("DICOM loaded"),onError:e=>console.error("DICOM error:",e)})})]}),o&&(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"15px",border:"1px solid #ddd",borderRadius:"4px",overflow:"hidden"},children:[t&&(0,r.jsxs)("div",{style:{padding:"10px",backgroundColor:"#f8f9fa",borderBottom:"1px solid #dee2e6"},children:[(0,r.jsx)("h3",{style:{margin:"0 0 10px 0",fontSize:"16px",color:"#495057"},children:"Tools"}),(0,r.jsx)(d,{onToolChange:e=>{p(e)}})]}),(0,r.jsx)("div",{style:{flex:1},children:(0,r.jsx)(s,{})})]})]})}}}]);